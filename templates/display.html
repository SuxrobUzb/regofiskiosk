<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navbat</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: var(--text); /* –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞ */
        }
        :root {
            --bg: #f4f7fa;
            --text: #2d3748;
            --card-bg: #ffffff;
            --primary: #1a73e8;
            --secondary: #34c759;
            --danger: #e53e3e; /* –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ */
        }
        body.dark {
            --bg: #1a202c;
            --text: #e2e8f0;
            --card-bg: #2d3748;
            --primary: #63b3ed;
            --secondary: #68d391;
            --danger: #f56565; /* –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ */
        }
        body {
            background: var(--bg);
            color: var(--text);
        }
        .header {
            display: flex;
            align-items: center;
            background: var(--card-bg);
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π */
            z-index: 10;
        }
        .header img {
            height: 50px;
            margin-right: 15px;
        }
        .header h1 {
            flex-grow: 1; /* –ß—Ç–æ–±—ã –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–Ω–∏–º–∞–ª –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
            font-size: 28px;
            color: var(--primary);
            text-align: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
        }
        .content {
            flex-grow: 1;
            display: flex;
            flex-direction: row; /* –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ —Ä—è–¥—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            width: 100%;
        }
        #videoSection {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
            overflow: hidden;
            position: relative;
        }
        #videoSection video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        #videoSection.fullscreen {
            flex: 1;
            width: 100%;
            height: 100%;
        }
        #queueSection {
            flex: 0 0 350px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ */
            background: var(--card-bg);
            padding: 20px;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        #queueSection.hidden {
            display: none;
        }
        #queueSection h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 24px;
            text-align: center;
        }
        #queueTable {
            width: 100%;
            border-collapse: collapse;
            font-size: 18px;
        }
        #queueTable th, #queueTable td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            text-align: left;
        }
        #queueTable th {
            background: var(--primary);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
        }
        #queueTable tr:nth-child(even) {
            background: var(--bg);
        }
        #queueTable tr:hover {
            background: #e9ecef; /* –°–ª–µ–≥–∫–∞ –º–µ–Ω—è–µ—Ç —Ñ–æ–Ω –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }
        body.dark #queueTable tr:hover {
            background: #3a475a;
        }
        .latest-call {
            background-color: var(--secondary) !important;
            color: white;
            animation: flash 1s infinite alternate; /* –ê–Ω–∏–º–∞—Ü–∏—è –º–∏–≥–∞–Ω–∏—è */
        }
        @keyframes flash {
            from { opacity: 1; }
            to { opacity: 0.5; }
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ —è–∑—ã–∫–∞ –∏ —Ç–µ–º—ã */
        .lang-switcher, .theme-switcher {
            position: absolute;
            top: 15px;
            display: flex;
            gap: 10px;
        }
        .lang-switcher { right: 80px; } /* –°–¥–≤–∏–≥–∞–µ–º –≤–ø—Ä–∞–≤–æ */
        .theme-switcher { right: 20px; }
        .lang-btn, .theme-toggle {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        .lang-btn:hover, .theme-toggle:hover {
            background: #155bb5;
        }
        .lang-btn.active {
            background: var(--secondary);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }
            .content {
                flex-direction: column; /* –ù–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö —Ä–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ —Å—Ç–æ–ª–±—Ü—ã */
            }
            #queueSection {
                flex: none; /* –û—Ç–∫–ª—é—á–∞–µ–º flex –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —à–∏—Ä–∏–Ω—ã */
                width: 100%; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É */
                max-height: 50vh; /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É, —á—Ç–æ–±—ã –≤–∏–¥–µ–æ –±—ã–ª–æ –≤–∏–¥–Ω–æ */
            }
            #videoSection {
                flex: 1;
                height: 50vh; /* –í–∏–¥–µ–æ –∑–∞–Ω–∏–º–∞–µ—Ç –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
            }
            .lang-switcher, .theme-switcher {
                position: static; /* –°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ */
                margin-top: 10px;
                justify-content: center;
                width: 100%;
                order: 3; /* –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤–Ω–∏–∑ */
            }
            .header {
                flex-wrap: wrap; /* –†–∞–∑—Ä–µ—à–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É */
                justify-content: center;
            }
            .header img {
                margin-bottom: 10px;
            }
            .header h1 {
                width: 100%; /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É */
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <!-- –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–æ—Ç–∏–ø (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å —Ñ–∞–π–ª static/logo.png) -->
        <img src="{{ server_url }}/static/logo.png" alt="Company Logo" onerror="this.style.display='none';">
        <h1 id="pageTitle">Navbat</h1>
        <div class="lang-switcher">
            <button class="lang-btn active" onclick="setLanguage('uz_lat')">UZ</button>
            <button class="lang-btn" onclick="setLanguage('ru')">RU</button>
            <button class="lang-btn" onclick="setLanguage('en')">EN</button>
        </div>
        <div class="theme-switcher">
            <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
        </div>
    </div>

    <div class="content">
        <div id="videoSection">
            <!-- –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∏–¥–µ–æ –∏–ª–∏ —Ä–µ–∫–ª–∞–º–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <video controls autoplay loop muted>
                <source src="{{ server_url }}/static/video.mp4" type="video/mp4" onerror="this.parentElement.innerHTML='<p style=\'color: white; font-size: 20px;\'>–í–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</p>';">
                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
            </video>
        </div>

        <div id="queueSection">
            <h2 id="queueTitle">Mijozlar Navbati</h2>
            <table id="queueTable">
                <thead>
                    <tr>
                        <th id="thOperator">Operator</th>
                        <th id="thTicket">Talon</th>
                        <th id="thOperatorNumber">Operator ‚Ññ</th> <!-- –ù–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü -->
                        <th id="thService">Xizmat</th> <!-- –ù–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü -->
                    </tr>
                </thead>
                <tbody>
                    <!-- –î–∞–Ω–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const serverUrl = '{{ server_url }}';
        let latestTicket = null; // –î–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—ã–∑–≤–∞–Ω–Ω–æ–≥–æ —Ç–∞–ª–æ–Ω–∞

        const translations = {
            uz_lat: {
                title: "Navbat",
                queue_title: "Mijozlar Navbati",
                operator: "Operator",
                ticket: "Talon",
                operator_number: "Operator ‚Ññ",
                service: "Xizmat",
                error_fetch: "Navbatni yangilashda xato: "
            },
            ru: {
                title: "–û—á–µ—Ä–µ–¥—å",
                queue_title: "–û—á–µ—Ä–µ–¥—å –∫–ª–∏–µ–Ω—Ç–æ–≤",
                operator: "–û–ø–µ—Ä–∞—Ç–æ—Ä",
                ticket: "–¢–∞–ª–æ–Ω",
                operator_number: "–ù–æ–º–µ—Ä –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞",
                service: "–£—Å–ª—É–≥–∞",
                error_fetch: "–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏: "
            },
            en: {
                title: "Queue",
                queue_title: "Client Queue",
                operator: "Operator",
                ticket: "Ticket",
                operator_number: "Operator No.",
                service: "Service",
                error_fetch: "Error updating queue: "
            }
        };
        let currentLang = 'uz_lat';

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –æ—á–µ—Ä–µ–¥–∏
        async function updateQueueTable() {
            try {
                const response = await fetch(`${serverUrl}/get_queue`);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const tickets = await response.json();
                const tableBody = document.querySelector("#queueTable tbody");
                tableBody.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É

                if (tickets.length === 0) {
                    document.getElementById("videoSection").classList.add("fullscreen");
                    document.getElementById("queueSection").classList.add("hidden");
                } else {
                    document.getElementById("videoSection").classList.remove("fullscreen");
                    document.getElementById("queueSection").classList.remove("hidden");
                    tickets.forEach(ticket => {
                        const row = document.createElement("tr");
                        if (ticket.ticket === latestTicket) row.classList.add("latest-call");
                        row.innerHTML = `
                            <td>${ticket.operator_name || 'N/A'}</td>
                            <td>${ticket.ticket}</td>
                            <td>${ticket.operator_number || 'N/A'}</td>
                            <td>${ticket.service_name || 'N/A'}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error("Error updating queue:", error);
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`button[onclick="setLanguage('${lang}')"]`).classList.add('active');
            
            document.getElementById('pageTitle').innerText = translations[lang].title;
            document.getElementById('queueTitle').innerText = translations[lang].queue_title;
            document.getElementById('thOperator').innerText = translations[lang].operator;
            document.getElementById('thTicket').innerText = translations[lang].ticket;
            document.getElementById('thOperatorNumber').innerText = translations[lang].operator_number;
            document.getElementById('thService').innerText = translations[lang].service;
            
            // –ü–æ—Å–ª–µ —Å–º–µ–Ω—ã —è–∑—ã–∫–∞, –æ–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
            updateQueueTable(); 
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
        function toggleTheme() {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            document.querySelector('.theme-toggle').innerText = isDark ? '‚òÄÔ∏è' : 'üåô';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        if (localStorage.getItem("theme") === "dark") {
            document.body.classList.add("dark");
            document.querySelector(".theme-toggle").innerText = "‚òÄÔ∏è";
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞—Ç–µ–ª—è –¥–ª—è —Å–æ–±—ã—Ç–∏—è ticket_called, —á—Ç–æ–±—ã –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∞–ª–æ–Ω—ã
        const socket = io(serverUrl); // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SocketIO
        socket.on('ticket_called', (data) => {
            latestTicket = data.ticket; // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–∑–≤–∞–Ω–Ω—ã–π —Ç–∞–ª–æ–Ω
            updateQueueTable(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫ –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            // const audio = new Audio('path/to/notification_sound.mp3'); // –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –∑–≤—É–∫—É
            // audio.play();
        });

        // –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —è–∑—ã–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setLanguage("uz_lat"); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        updateQueueTable(); // –ü–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setInterval(updateQueueTable, 5000); // –û–±–Ω–æ–≤–ª—è—Ç—å –æ—á–µ—Ä–µ–¥—å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    </script>
</body>
</html>
